# Project Aletheia - Default Configuration
# Neural Morphogenesis Engine for 4x NVIDIA A16 GPUs

# =============================================================================
# SYSTEM CONFIGURATION
# =============================================================================
system:
  seed: 42
  deterministic: true
  benchmark: true
  
  # GPU Configuration (4x A16, 16GB each)
  gpus:
    count: 4
    memory_per_gpu_gb: 15  # Leave 1GB headroom per GPU
    total_memory_gb: 60    # Safe total allocation
    
  # A16 Ampere Architecture Optimization
  cuda:
    device_memory_fraction: 0.94
    allow_growth: false
    matmul_precision: "high"  # TF32 on Ampere
    cudnn_benchmark: true
    
  # Paths
  paths:
    output: "/data/frames"
    checkpoints: "./checkpoints"
    logs: "./logs"
    metadata: "./output"

# =============================================================================
# SIMULATION PARAMETERS
# =============================================================================
simulation:
  # Particle Configuration
  num_particles: 10_000_000
  particles_per_gpu: 2_500_000
  
  # Time Integration
  total_frames: 1000
  substeps_per_frame: 20
  dt: 5.0e-5
  
  # Domain Configuration
  domain:
    min: [-2.0, -2.0, -2.0]
    max: [2.0, 2.0, 2.0]
    grid_resolution: 256
    
  # Physics Mode
  physics:
    mode: "mpm"  # mpm, sph, or hybrid
    gravity: [0.0, -0.5, 0.0]
    damping: 0.999
    
  # Material Properties (Organic/Squishy)
  material:
    type: "neo_hookean"
    density: 1000.0
    young_modulus: 5000.0
    poisson_ratio: 0.35
    viscosity: 0.1

# =============================================================================
# NEURAL FIELD CONFIGURATION
# =============================================================================
neural:
  # Model Selection
  model_type: "fno"  # fno, unet, or hybrid
  
  # Latent DNA Configuration
  latent:
    dim: 512
    seed_type: "gaussian"  # gaussian, uniform, or structured
    
  # Fourier Neural Operator (FNO)
  fno:
    modes: [16, 16, 16]
    width: 64
    num_layers: 4
    activation: "gelu"
    
  # U-Net Neural MPM
  unet:
    base_channels: 64
    channel_multipliers: [1, 2, 4, 8]
    num_res_blocks: 2
    attention_resolutions: [16, 8]
    dropout: 0.1
    
  # Training Configuration
  training:
    learning_rate: 1.0e-4
    weight_decay: 1.0e-5
    batch_size: 4
    gradient_accumulation: 2
    mixed_precision: true
    gradient_checkpointing: true
    
  # DDP Configuration
  distributed:
    backend: "nccl"
    find_unused_parameters: false
    broadcast_buffers: true

# =============================================================================
# PDE / PHYSICS PERTURBATION
# =============================================================================
pde:
  # Base Equations
  base_type: "reaction_diffusion"  # navier_stokes, reaction_diffusion, or coupled
  
  # Navier-Stokes Parameters
  navier_stokes:
    viscosity: 0.01
    pressure_iterations: 50
    vorticity_confinement: 0.5
    
  # Reaction-Diffusion (Turing Patterns)
  reaction_diffusion:
    diffusion_a: 1.0
    diffusion_b: 0.5
    feed_rate: 0.055
    kill_rate: 0.062
    
  # Neural Perturbation
  perturbation:
    strength: 0.3
    frequency_bands: 8
    spatial_scale: [0.1, 0.5, 1.0, 2.0]

# =============================================================================
# SELF-ORGANIZATION DYNAMICS
# =============================================================================
morphogenesis:
  # Growth Phases
  phases:
    chaos_frames: [0, 100]        # Initial chaotic cloud
    emergence_frames: [100, 400]  # Structure emergence
    refinement_frames: [400, 700] # Detail refinement
    stabilization_frames: [700, 1000]  # Final stabilization
    
  # Attractors
  attractors:
    type: "neural"  # neural, geometric, or hybrid
    strength_schedule: "cosine"
    min_strength: 0.1
    max_strength: 1.0
    
  # Structure Templates (for guidance)
  templates:
    - name: "neural_network"
      weight: 0.3
    - name: "coral_lattice"
      weight: 0.3
    - name: "stellar_nursery"
      weight: 0.4

# =============================================================================
# RENDERING CONFIGURATION
# =============================================================================
render:
  # Output Resolution
  resolution: [3840, 2160]  # 4K
  
  # Ray Tracing
  raytracing:
    enabled: true
    samples_per_pixel: 64
    max_bounces: 8
    russian_roulette_depth: 4
    
  # Camera
  camera:
    type: "perspective"
    fov: 45.0
    position: [0.0, 0.0, 8.0]
    look_at: [0.0, 0.0, 0.0]
    up: [0.0, 1.0, 0.0]
    
    # Camera Animation
    animation:
      enabled: true
      type: "orbit"  # orbit, dolly, or custom
      orbit_radius: 8.0
      orbit_speed: 0.5
      
  # Depth of Field
  dof:
    enabled: true
    aperture: 0.02
    focus_distance: 8.0
    bokeh_shape: "circular"
    
  # Motion Blur
  motion_blur:
    enabled: true
    shutter_time: 0.5
    samples: 8
    
  # Bioluminescent Bloom
  bloom:
    enabled: true
    intensity: 2.5
    threshold: 0.8
    radius: 0.01
    color_shift: [1.0, 0.9, 1.2]  # Slight purple tint
    
  # Color Grading
  color:
    exposure: 1.2
    gamma: 2.2
    saturation: 1.1
    contrast: 1.05
    
  # Particle Appearance
  particles:
    base_radius: 0.002
    emission_strength: 5.0
    color_palette: "bioluminescent"
    color_by: "velocity"  # velocity, density, temperature

# =============================================================================
# OUTPUT CONFIGURATION
# =============================================================================
output:
  # Frame Export
  frames:
    format: "png"
    quality: 100
    naming: "frame_{:06d}.png"
    
  # Video Generation
  video:
    enabled: true
    format: "mp4"
    codec: "libx264"
    crf: 18  # High quality
    preset: "slow"
    fps: 30
    
  # Metadata
  metadata:
    save_latent_dna: true
    save_particle_stats: true
    save_render_params: true
    format: "json"

# =============================================================================
# MEMORY MANAGEMENT (Critical for Shared Environment)
# =============================================================================
memory:
  # Per-GPU Limits
  max_allocation_gb: 15
  
  # Particle Chunking
  chunk_size: 500_000
  prefetch_chunks: 2
  
  # Gradient Management
  gradient_checkpointing: true
  empty_cache_frequency: 10  # Every N frames
  
  # Emergency Fallback
  oom_retry: true
  oom_chunk_reduction: 0.8

# =============================================================================
# LOGGING & MONITORING
# =============================================================================
logging:
  level: "INFO"
  console: true
  file: true
  
  # Progress Tracking
  progress:
    update_frequency: 10
    show_eta: true
    show_memory: true
    
  # TensorBoard
  tensorboard:
    enabled: true
    log_frequency: 50
    
  # Weights & Biases (optional)
  wandb:
    enabled: false
    project: "aletheia"
    entity: null
